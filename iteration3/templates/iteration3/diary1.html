﻿{% load static %}
{% if request.session.is_login %}
    <head>
      <!-- BEGIN: Title -->
      <title>Diatastic &mdash; Easily Manage Blood Sugar</title>
      <!-- END: Title -->

      <!-- BEGIN: Meta -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- END: Meta -->

      <!-- BEGIN: Favicon -->
      <link rel="shortcut icon" href="/static/images/icons8-rh-plus-gradient-16.png">
      <!-- END: Favicon -->

      <!-- BEGIN: Stylesheets -->
        <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.css">
      <link rel="stylesheet" href="/static/css/tiny-slider.css">
      <link rel="stylesheet" href="/static/fonts/lineicons/LineIcons.min.css">
      <link rel="stylesheet" href="/static/fonts/icomoon/style.css">
      <link rel="stylesheet" href="/static/css/animate.min.css">
      <link rel="stylesheet" href="/static/css/jquery.lavalamp.css">
      <link rel="stylesheet" href="/static/css/jquery.fancybox.min.css">
      <link rel="stylesheet" href="/static/css/style.css">
      <link rel="stylesheet" href="/static/css/select.css">
      <!-- END: Stylesheets -->


    </head>

    <body>
    <!-- ***** Boostrap Custom / Addons Stylesheets ***** -->
    <link href="/static/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/static/assets/plugins/material_icon/icon.css" rel="stylesheet"/>
    <script src="/static/js/bot.js" defer></script>


      <!-- BEGIN: .site-wrap -->
      <div class="site-wrap">

        <!-- BEGIN: #site-header -->
        <!--
          Add class '.position-relative' to display it as stack.
          Add '.navbar-light' to make the text dark or black.
        -->
        <header id="site-header" class="position-relative">

          <!-- Add '.navbar_dark' class if you want the color of the text to -->
          <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">

              <!-- BEGIN: .navbar-brand -->
              <div style="margin-left:3%">
              <a class="navbar-brand" href="/index/">
              <img src="/static/images/icons8-rh-plus-gradient-32.png" >Diatastic
    <!--          <img src="../static/images/logo_dark.png" alt="Covid" id="logo_dark">-->
              </a>
              </div>
              <!-- END: .navbar-brand -->

              <!-- BEGIN: .navbar-toggler -->
              <a href="#" class="burger-toggle-menu js-burger-toggle-menu ml-auto py-4" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
              </a>
              <!-- END: .navbar-toggler -->

              <!-- BEGIN: #main-nav -->
              <div class="collapse navbar-collapse" id="main-nav">

                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                    <a class="nav-link" href="/index/">Home</a>
                  </li>
                  <li class="nav-item  active">
                    <a class="nav-link active" href="/diary/">Diary</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/list_view/">History</a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="/carb_chart/"><font color="black">Metrics</font></a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="/guide/">Beginner's Guide</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/tips/">Tips and Tricks</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/faq/">FAQ</a>
                  </li>
                </ul>
                </ul>

              </div>
              <!-- END: #main-nav -->

            </div>
            <ul style="margin-right:1%;margin-top:1%;">
                  <li class="nav-item">
                    <a class="nav-link" href="#"><font color="blue">User:{{ request.session.user_name }}</font></a>
                  </li>
                </ul>
                <ul style="margin-right:1%;margin-top:1%;">
                  <li class="nav-item">
                      <a class="nav-link" href="/logout/"><font color="red">Log out</font></a>
                  </li>
                </ul>
          </nav>
        </header>
        <!-- END: #site-header -->

        <!-- BEGIN: .cover -->
        <div class="page-heading-85912" style="background-image: url('images/hero_bg_3.jpg')">
          <div class="container">
            <div class="row align-items-end">
              <div class="col-lg-7">
                <h1 class="mb-0 heading text-white">Diary</h1>
                <p class="mb-0 text-white">Healthy living starts with your daily diet. </p>
              </div>
            </div>
          </div>
        </div>

        <div class="custom-breadcrumns-23195 border-bottom">
          <div class="container">
            <a href="/Diary/index/">Home</a>
            <span class="mx-3 icon-keyboard_arrow_right"></span>
            <span class="current">Diary</span>
          </div>
        </div>
        <span></span>


<form method="post"
      id = "DiaryForm"
      action = "/diary/"
      data-description-url="{% url 'ajax_load_description' %}"
      data-portion-url="{% url 'ajax_load_portion' %}"
      create_view="{% url 'create_view' %}">
    {% csrf_token %}


    <div class="container">
        <br>
        <div style="text-align: center;">
            <h1>Enter your Diary</h1>
        </div>
<!--    Date Time-->
        <br><br><br>
        <div style="text-align: center;display: inline;">
<!--            <div>-->
<!--                <div style="float: left;"><label for="date" style="margin-right: 20%">Date:</label></div>-->
<!--                <div style="float: left;"><label for="time" style="margin-right: 20%;">Time: </label></div>-->
<!--                <div style="float: left;"><label for="blood_sugar_level" style="margin-right: 5%">Blood Sugar Level: </label></div>-->
<!--            </div>-->
            <fieldset style="display: inline;margin-left:15%">
            <legend>Date:</legend>
            <div style="display: inline-block; width: 200px;">
<!--                <label for="date">Date:</label>-->
                    <input name="date" id="date" type="date" class="form-control" required="required"/>
              </div>
                </fieldset>
    <!--      Time field.-->
            <fieldset style="display: inline;">
                <legend>Time:</legend>
              <div style="display: inline-block; width: 200px;">
<!--                  <label for="time">Time: </label>-->
                        <input name="time" id="time" type="time" class="form-control" required="required"/>
              </div>
            </fieldset>

            <!--      blood_sugar_level field.-->
            <fieldset style="display: inline;">
            <legend>Blood Sugar Level:</legend>
          <div id="bsl_slider" class="form-class numeric-slider" style="display: inline">
<!--              <label for="blood_sugar_level">Blood Sugar Level: </label>-->
<!--                Number input-->
                    <input name="blood_sugar_level" id="blood_sugar_level" type="number"
                           min = "1" max="30" step="0.1"
                           class="form-control" style="display: inline; width: 180px;"
                           required="required" value="{{blood_sugar_level}}"/>

<!--                Slider input-->
              <span class="font-weight-bold" style="margin-left: 10px">1</span>
                    <input name="blood_sugar_level_slider" id="blood_sugar_level_slider" type="range" min="1" max="30" step="0.1"
                           class="slider" style="display: inline; width: 150px;"
                           required="required"/>
              <span class="font-weight-bold">30</span>
          </div>
        </fieldset>
            <br><br>
        </div>
        <fieldset style="margin-left:15%">
                     <legend>Comment:</legend>
                    <input id="comment" type="text" style="width:300%">
                 </fieldset>
        <br/>

<!--      Menu options-->
          <div class="container">
            <div class="wrapper">
            <table id="myTable1" cellspacing="0" cellpadding="0" border="0" class="normTbe model1 hide">
                <tbody>
                    <tr id="alonTr1" class="alonTr">
                        <td><input id="text1" type="text" value="" readonly></td>
                        <td><input id="text2" type="text" value="" readonly></td>
                        <td><input id="text3" type="text" value="" readonly></td>
                        <td><input id="text4" type="text" value="" readonly></td>
                        <td>
    <!--                        <a href="javascript:;" class="AddTr">add</a>-->
                            <a class="text_a" href="javascript:;" onclick="deltr(this)"><button type="button" class="btn btn-danger">Delete</button></a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="itemInfo">
                <table id="myTable" cellspacing="0" cellpadding="0" border="0" class="normTbe tabInfo">
                    <thead>
                        <tr>
                            <th><label for="category">Category:</label></th>
                            <th><label for="description">Desc:</label></th>
                            <th><label for="portion">Portion:</label></th>
                            <th><label for="quantity">Quantity:</label></th>
                            <th>action</th>
                        </tr>
                    </thead>
                    <tbody class="tbody1">
                        <tr>
                            <td><select id="category" name="category" class="form-control" action="{% url 'ajax_load_description' %}">
                                <option value="">Choose One</option>
                                  {% for cat in category %}
                                    <option value="{{cat.id}}">{{cat.name}}</option>
                                  {% endfor %}
                                </select>
                            </td>
                            <td><select id="description" name="description" class="form-control" action="{% url 'ajax_load_portion' %}">
                                <option value="">Choose One</option>
                                  {% for desc in description %}
                                    <option value="{{desc.id}}">{{desc.name}}</option>
                                  {% endfor %}
                                </select>
                            </td>
                            <td><select id="portion" name="portion" class="form-control">
                                    <option value="">Choose One</option>
                                      {% for port in portion %}
                                        <option value="{{port.id}}">{{port.name}}</option>
                                      {% endfor %}
                                </select>
                            </td>
                            <td><input type="number"  id='quantity' onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"></td>
                            <td>
                                <a href="javascript:;" class="AddTr"><button type="button" class="btn btn-primary">Confirm</button></a>
    <!--                            <a class="text_a" href="javascript:;" onclick="deltr(this)">delete</a>-->
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div><!-- itemInfo -->
            </div>
        <br>
            <div style="text-align: center;">
<!--                <button  type="reset" class="btn btn-danger">Reset</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
<!--                 <fieldset style="margin-left:15%">-->
<!--                     <legend>comment:</legend>-->
<!--                    <input id="comment" type="text" style="width:300%">-->
<!--                 </fieldset>-->
                <br><br>
                <button name="submit" id="submit" type="submit" class="btn btn-success">Submit</button>
                <br><br>
          </div>
    </div>
</form>
        <!-- END: diary form -->


<!--         BEGIN: #footer-->
        <footer id="footer">
          <div class="container">

            <!-- BEGIN: .footer-subscribe -->
            <div class="row footer-subscribe">
              <div class="col-md-6">
                <h3 class="mt-2"></h3>
              </div>
              <div class="col-md-6">
              </div>
            </div>
            <!-- END: .footer-subscribe -->

            <div class="row">
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <!-- BEGIN: .widget -->
                <div class="widget">
                  <h3>Our Motivation.</h3>
                </div>
                <!-- END: .widget -->
              </div>
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <!-- BEGIN: .widget -->
                <div class="widget">
                  <h3>Our Job.</h3>
                </div>
                <!-- END: .widget -->
              </div>
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <!-- BEGIN: .widget -->
                <div class="widget">
                  <h3>Our Data.</h3>
                </div>
                <!-- END: .widget -->
              </div>
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <div class="d-block">
                </div>
                <div class="d-block">
                  <p>If you have any question, please contact us at <a href="#" class="link-underline text-primary">info@diatastic.tk</a></p>
                </div>
              </div>
            </div>
            <div class="col-md-6 text-center text-md-left">
                <p>Diatastic is a management tool created for diabetics, to help them manage their disability. Our website is intended to be an everyday companion for diabetics, giving them the motivation and tools necessary to live happy and healthy lives.</a></p>
              </div>
            <!-- BEGIN: .copyright -->
            <div class="row copyright">
              <div class="col-md-6 order-2 text-center text-md-right"><a href="#" class="js-top"><span class="icon-long-arrow-up mr-2"></span> Go to Top</a></div>
<!--              <div class="col-md-6 text-center text-md-left">-->
<!--                <p>Diatastic is a management tool created for diabetics, to help them manage their disability. Our website is intended to be an everyday companion for diabetics, giving them the motivation and tools necessary to live happy and healthy lives.</a></p>-->
<!--              </div>-->
            </div>
            <!-- END: .copyright -->
          </div>
        </footer>
<!--         END: #footer -->

      </div>
      <!-- END: .site-wrap -->

      <!-- Loader -->
      <div id="site-overlayer"></div>
      <div class="site-loader-wrap">
        <div class="site-loader"></div>
      </div>
</body>
      <!-- BEGIN: JavaScripts -->
<script src="/static/js/jquery-3.4.1.min.js"></script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.waypoints.min.js"></script>
<script src="/static/js/jquery.animateNumber.min.js"></script>
<script src="/static/js/tiny-slider.js"></script>
<script src="/static/js/jquery.fancybox.min.js"></script>
<script src="/static/js/jquery.lavalamp.min.js"></script>
<script src="/static/js/jquery.ajaxchimp.min.js"></script>
<script src="/static/js/jquery.validate.min.js"></script>
<script src="/static/js/jquery.easing.1.3.js"></script>
<script src="/static/js/main.js"></script>

<script src="/static/js/select.js"></script>

      <!--   Core JS Files   -->
    <!--  <script src="../static/assets/plugins/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>-->
<script src="/static/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="/static/assets/plugins/backstretch/backstretch.js" type="text/javascript"></script>
<script src="/static/assets/js/app.js"></script>
<script src="/static/add/js/jquery-1.11.3.min.js"></script>
<!--<script src="/static/add/jquery-1.11.3.min.js"></script>-->


      <!-- END: JavaScripts -->

<!--Ajax query for description dropdown.-->
<script>
    var global_cat = 0;
    var global_desc = 0;
    var global_port = 0;
    var global_quantity = 0;
    $("#category").change(function () {
      var e = document.getElementById('category');
      var url = $("#DiaryForm").attr("data-description-url");
      var categoryId = $('#category').val();
      console.log($(this).val());
      global_cat = categoryId;
      $.ajax({
        url: url,
        data: {
          'category': global_cat
        },
        success: function (data) {
            $("#description").html(data);
        }

      });

    });
  </script>


<!--Ajax query for portion description dropdown.-->
<script>
    $("#description").change(function () {
      var e = document.getElementById('description');
      var url = $("#DiaryForm").attr("data-portion-url");  // get the url of the `load_cities` view
      var descriptionId = $('#description').val();  // get the selected country ID from the HTML input
      global_desc = descriptionId;
      console.log($(this).val());
      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'category': global_cat,
          'description': descriptionId
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
            $("#portion").html(data);  // replace the contents of the city input with the data that came from the server

        }
      });

    });
  </script>

<script>
    var global_cat = 0;
    var global_desc = 0;
    var global_port = 0;
    var global_quantity = 0;
    $("#category1").change(function () {
      var e = document.getElementById('category');
      var url = $("#DiaryForm").attr("data-description-url");
      var categoryId = $('#category1').val();
      console.log($(this).val());
      global_cat = categoryId;
      $.ajax({
        url: url,
        data: {
          'category': global_cat
        },
        success: function (data) {
            $("#description1").html(data);
        }

      });

    });
  </script>


<!--Ajax query for portion description dropdown.-->
<script>
    $("#description1").change(function () {
      var e = document.getElementById('description');
      var url = $("#DiaryForm").attr("data-portion-url");  // get the url of the `load_cities` view
      var descriptionId = $('#description1').val();  // get the selected country ID from the HTML input
      global_desc = descriptionId;
      console.log($(this).val());
      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'category': global_cat,
          'description': descriptionId
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
            $("#portion1").html(data);  // replace the contents of the city input with the data that came from the server

        }
      });

    });
  </script>




<script>
    let range=document.querySelector("input[type=range]");
    let number=document.querySelector('input[type=number]')

    range.addEventListener("input",(e)=>{
      number.value=e.target.value;
    })
    number.addEventListener("input",(e)=>{
      range.value=e.target.value;
    })
    </script>








<script>
var url = "{% url 'create_view' %}";
function SendCart(){
    var data = {cart_items: JSON.stringify(cart_dict), csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value};
    var posting = $.post('/create_view/', data);
}
</script>

<script>
$(document).ready(function (){
    $('#submit').click(function(){
    SendCart();
    });
    });
</script>

<script>
count = 1;
show_count = 20;
cart_dict = new Array();
    $(function () {
        $('.tbody1').on("click", ".alonTr .innerbtn", function () {
            $(this).next('.pop_box').slideDown('400');
        })
        $('.tbody1').on("click", ".alonTr .closepop", function () {
            $('.pop_box').slideUp('400');
        })

        // add new row

        $(".AddTr").click(function () {
            var length = $(".tabInfo .tbody1>tr").length;
            console.log(length);
            //alert(length);
            if (length < show_count) {
                var date = $('#date').val();
                if(date.trim() == ''){
                    alert('Please check the date.');}
                else{

                    var time = $('#time').val();
                    if(time.trim() == ''){
                        alert('Please check the time.');}
                    else{

                        var BSL = parseInt($('#blood_sugar_level').val());
                        if(BSL != ''){
                        if(BSL > 30 || BSL < 0){
                            alert('Please check your Blood Sugar Levels.');}
                            else{

                            var categoryId = parseInt($('#category').val());
                            if(!parseInt(categoryId) || categoryId == ''){
                                alert('Please check the category.');}
                            else{

                                var descriptionId = parseInt($('#description').val());
                                if(!parseInt(descriptionId) || descriptionId == ''){
                                    alert('Please check the description.');}
                                else{

                                    var portionId = parseInt($('#portion').val());
                                    if(!parseInt(portionId) || portionId == ''){
                                        alert('Please check the portions.');}
                                    else{

                                        var Q = parseInt($('#quantity').val());
                                        if(!parseInt(Q) || Q == ''){
                                            alert('Please check the quantity.');}
                                        else{
                                            var dup = 0;
                                        }
                                        var comment = $('#comment').val();

                                        // If dictionary is not empty:
                                        if(cart_dict.length != 0){

                                            // Iterate through the dictionary.
                                            for(i = 0; i < cart_dict.length; i++){
<!--                                                console.log((cart_dict[i]['categoryId'] == categoryId ) && (cart_dict[i]['descriptionId'] == descriptionId) && (cart_dict[i]['portionId'] == portionId));-->
                                                if((cart_dict[i]['categoryId'] == categoryId ) && (cart_dict[i]['descriptionId'] == descriptionId) && (cart_dict[i]['portionId'] == portionId)){
                                                    dup = 1;
                                                    console.log(dup);
                                                    break;}
                                                }
                                            }
                                        if(dup == 1){
                                            cart_dict[i]['Q'] = cart_dict[i]['Q'] + Q;
                                            document.querySelector("#quantity"+parseInt(i+1)).setAttribute('value', cart_dict[i]['Q']);
                                                    }
                                        else{
                                            document.querySelector("#text1").setAttribute('value', category.options[category.selectedIndex].text);
                                            document.querySelector("#text2").setAttribute('value', description.options[description.selectedIndex].text);
                                            document.querySelector("#text3").setAttribute('value', portion.options[portion.selectedIndex].text);
                                            document.querySelector("#text4").setAttribute('value', parseInt($('#quantity').val()));
                                            document.querySelector("#text1").id = "category"+count;
                                            document.querySelector("#text2").id = "description"+count;
                                            document.querySelector("#text3").id = "portion"+count;
                                            document.querySelector("#text4").id = "quantity"+count;
                                            document.querySelector("#alonTr1").id = "alonTr"+count;

                                            $(".model1 tbody .alonTr").clone().appendTo(".tabInfo .tbody1");

                                            document.querySelector("#category"+count).id = "text1";
                                            document.querySelector("#description"+count).id = "text2";
                                            document.querySelector("#portion"+count).id = "text3";
                                            document.querySelector("#quantity"+count).id = "text4";
                                            document.querySelector("#alonTr"+count).id = "alonTr1";
                                            count++;
                                            cart_dict.push({'date':date, 'time': time, 'BSL': BSL,
                                                            'categoryId': categoryId, 'descriptionId': descriptionId, 'portionId': portionId,
                                                            'Q': Q,'comment':comment
                                                            });
                                                    }
            }
            }
            console.log(cart_dict);
            $('#category:input').val('Choose One');
            $('#description:input').val('Choose One');
            $('#portion:input').val('Choose One');
            $('#Q').val(0);
            }
            }
            }
            }
            }
            }
            });
            console.log('Count after adding item:', count);
        });



    function deltr(opp) {
        var length = $(".tabInfo .tbody1>tr").length;
        //alert(length);
        if (length <= 1) {
            alert("less one row");
        } else {
            count--;
            $(opp).parent().parent().remove();//delete row
            id = parseInt($(opp).parent().parent().attr('id').slice(-1));
            console.log(id);
            cart_dict.splice(id-1, 1);
            console.log(cart_dict);
            console.log('Count after removing item:', count);
        }
    }


</script>
<style>
    table {
        table-layout: fixed;
        width: 100%;
    }

    input, button, select, textarea {
        outline: none;
        resize: none;
        padding: 3px 5px;
        border: 1px solid #ddd;
    }

        input:focus, textarea:focus {
            border: 1px solid #9ab6d6;
        }

    .whiteBg {
        background: #fff;
    }

    .normTbe {
        border-left: 1px solid #ddd;
        border-top: 1px solid #ddd;
    }

        .normTbe td, .normTbe th {
            border-bottom: 1px solid #ddd;
            border-right: 1px solid #ddd;
            padding: 15px;
            text-align: center;
        }

        .normTbe input {
            width: 80%;
            text-align: center;
        }

    .wrapper {
        width: 82.6%;
        padding: 0 20px;
        margin:0 auto;
        clear: both;
    }

    .hide {
        display: none;
    }

    .hideTr {
        background: #ddd;
    }


    .btn_a1 {
        padding-top: 15px;
    }

        .btn_a1 a {
            display: inline-block;
            *display: inline;
            *zoom: 1;
            width: 120px;
            line-height: 45px;
            background: #50abfd;
            color: #fff;
        }

        .btn_a1 .addtr2, .btn_a1 .dtadd {
            background: #ff9900;
        }

fieldset {
  width: max-content;
}

legend {
  font-size: 12px;
}

#exampleDataList {
  width: 15rem;
  border: none;
}

#exampleDataList:focus {
  outline: none;
}
</style>

{% else %}
<script type="text/javascript">
    window.location.href = "/please_login/";
</script>
{% endif %}